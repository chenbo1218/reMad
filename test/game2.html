<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>打飞机</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }

        #main{
            position: relative;
            width: 400px;
            height: 600px;
            margin: 50px auto;
        }

        /*地图*/
        #map{
            overflow: hidden;
            position: relative;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: #000;
            /*background-image: url("img/bg_1.jpg");*/
            /*background-size: 100%;*/
        }

        #btn{
            width: 100px;
            height: 30px;
            position: absolute;
            bottom: 30px;
            left: 50%;
            margin-left: -50px;
        }




    </style>
</head>
<body>
    <div id="main">
        <div id="map"></div>
        <button id="btn">开始游戏</button>
    </div>


    <script>
        //==================全局变量========================
        //基本方块的px值
        const PIX = 10;

        //主容器
        var _main = document.getElementById("main");
        //地图
        var _map = document.getElementById("map");
        //开始按钮
        var _btn = document.getElementById("btn");

        //地图宽度
        var _mapWidth = Math.floor(_map.offsetWidth/PIX);//40
        //地图高度
        var _mapheight = Math.floor(_map.offsetHeight/PIX);//60

        //我方灰机
        var _plane;
        //子弹数组
        var _bullets = [];
        //敌方灰机组
        var _enemys = [];



        //====================程序入口========================
        //开始搞事
        main();

        //入口函数
        function main(){
            //点击开始
            _btn.onclick = start();
        }

        function start(){
            _btn.style.display = "none";

            //初始飞机位置
            _plane = new Plane(20,40,3);
            _plane.show();

            //鼠标移动事件--移动本方飞机
            // _map.addEventListener("mousemove",movePlane,true);
            _map.onmousemove = function(e){
                var ev = e || window.event;
                _plane.move(ev.clientX, ev.clientY);
            }

            //键盘事件--按下空格发射子弹
            document.onkeydown = function(e){
                var ev = e || window.event;
                if(ev.keyCode == 32){
                    var x = _plane.div.offsetLeft + Math.floor(_plane.width/2)*PIX;
                    var y = _plane.div.offsetTop + (_plane.height/2)*PIX;
                    var bullet = new Bullet(x, y);
                    _bullets.push(bullet);
                    bullet.show();
                    //子弹自动飞行
                    var timer = setInterval(function(){
                        bullet.move();
                        //子弹出界则清除子弹和计时器
                        if(bullet.div.offsetTop<=0){
                            _map.removeChild(bullet.div);
                            _bullets.splice(_bullets.indexOf(bullet),1);
                            clearInterval(timer);
                            timer = null;
                        }
                    },20);
                }
            }

        }

        //===================函数构造==========================
        //构造飞机
        function Plane(x, y, hp){
            this.width = 5;//单元格个数为单位的宽度
            this.height = 4;//单元格个数为单位的高度
            this.x = x;
            this.y = y;
            this.hp = hp;
            this.speed = 20;
            this.body = [
                {x:2,y:0},

                {x:0,y:1},
                {x:1,y:1},
                {x:2,y:1},
                {x:3,y:1},
                {x:4,y:1},

                {x:2,y:2},

                {x:1,y:3},
                {x:2,y:3},
                {x:3,y:3}
            ];

            //显示
            this.show = function(){
                var p = document.createElement("div");
                for(var i=0; i<this.body.length; i++){
                    var pp = document.createElement("div");
                    pp.style.width = PIX + "px";
                    pp.style.height = PIX + "px";
                    pp.style.position = "absolute";
                    pp.style.background = "yellow";
                    pp.style.left = this.body[i].x * PIX + "px";
                    pp.style.top = this.body[i].y * PIX + "px";
                    p.appendChild(pp);
                }
                p.style.width = this.width * PIX + "px";
                p.style.height = this.height * PIX + "px";
                p.style.position = "absolute";
                p.style.left = this.x*PIX - Math.ceil(this.width/2)*PIX + "px";
                p.style.top = this.y*PIX - this.height*PIX/2 + "px";
                this.div = p;
                _map.appendChild(p);
            }

            //随鼠标移动
            this.move = function(mouseX, mouseY){
                // console.log(mouseX + ","+mouseY);
                // console.log(mouseX - _main.offsetLeft + ">>>" + mouseY - _main.offsetTop);
                if(this.div){
                    this.div.style.left = mouseX - _main.offsetLeft - Math.ceil(this.width/2)*PIX + "px";
                    this.div.style.top = mouseY - _main.offsetTop - this.height*PIX/2 + "px";
                }
            }

            //销毁
            this.destroy = function(){
                if(this.div != null){
                    _map.removeChild(this.div);
                    this.div = null;
                }
            }

        }

        //构造子弹
        function Bullet(x, y){
            this.x = x;
            this.y = y;

            //显示
            this.show = function(){
                var b = document.createElement("div");
                b.style.cssText = "background:#fff;position:absolute;width:"+PIX+"px;height:"+PIX+"px;";
                b.style.left = this.x + "px";
                b.style.top = this.y + "px";
                this.div = b;
                _map.appendChild(b);
            }

            this.move = function(){
                this.div.style.top = this.div.offsetTop-20+"px";
            }

        }

        //构建敌机
        function Enemy(x, y){


        }











    </script>



</body>
</html>