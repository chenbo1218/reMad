<!--
* 私聊窗口
*
* create by Sam on 2019/10/30
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="icon" type="image/png" href="../assets/img/logo.png">
    <title>发红包啦</title>
    <link type="text/css" rel="stylesheet" href="../lib/weui.min.css" />
    <link type="text/css" rel="stylesheet" href="../lib/jquery-weui.min.css" />

    <link rel="stylesheet" href="../css/common.css">
    <style>
        /*聊天框*/
        .box{
            width: 100%;
            height: auto;
            background-size: cover;
            box-sizing: border-box;
        }

        .cont{
            width: 100%;
            height: auto;
            /*margin-bottom: 60px;*/
            box-sizing: border-box;
            padding: 0px 20px;
            overflow-x: hidden;
            overflow-y: scroll;
            position: fixed;
            top: 70px;
            bottom: 60px;
        }

        /*聊天块*/
        .chat{
            width: 100%;
            height: auto;
            margin: 10px 0px;
        }
        .chat .ava{
            width: 38px;
            height: 38px;
            display: block;
            float: left;
        }
        .chat .jian{
            width: 0px;
            height: 0px;
            border-style: solid;
            border-width: 5px;
            border-color:  transparent #fff transparent transparent;
            float: left;
            margin-top: 10px;
        }
        .chat .txt{
            width: auto;
            /*max-width: 300px;*/
            max-width: 70%;
            height: auto;
            line-height: 20px;
            background: white;
            float: left;
            border-radius: 3px;
            padding: 10px 5px;
        }
        .chat:after, .mychat:after{
            display:block;
            content:' ';
            clear:both;
        }
        .mychat .ava{
            float: right;
        }
        .mychat .jian{
            border-color:  transparent transparent transparent #9eea6a;
            float: right;
        }
        .mychat .txt{
            background-color: #9eea6a;
            float: right;
        }

        /*操作栏*/
        .bar{
            width: 100%;
            height: auto;
            /*height: 60px;*/
            /*line-height: 60px;*/
            padding: 10px 10px;
            box-sizing: border-box;
            position: fixed;
            bottom: 0;
            left: 0;
            background-color: #fff;
        }
        .bar .opts{
            width: 100%;
            height: 40px;
        }

        .bar .ipt{
            width: 70%;
            height: 40px;
            line-height: 40px;
            padding: 0 10px;
            border: none;
            float: left;
            box-sizing: border-box;
            background-color: #e8e8e8;
            border-radius: 10px;
        }
        .bar .btns{
            width: 30%;
            height: 40px;
            line-height: 40px;
            float: left;
            position: relative;
        }
        .btns .btn{
            display: block;
            width: 50%;
            height: 100%;
            line-height: 100%;
            text-align: center;
            position: absolute;
        }
        .btns .btn img{
            height: 40px;
            width: 40px;
        }
        .btn-emoji{
            left: 0;
            top: 0;
        }
        .btn-more, .btn-send{
            left: 50%;
            top: 0;
        }
        .btn-send{
            height: 34px !important;
            line-height: 34px !important;
            margin-top: 3px;
            color: #fff;
            background: #fe4c55;
            border-radius: 12px;
        }

        .bar .menus{
            width: 100%;
            height: 160px;
        }
        .weui-grid{
            width: 25%;
            height: 80px;
            padding: 0 0;
        }
        .weui-grids:after, .weui-grids:before{
            border: none;
        }
        .weui-grid:after, .weui-grid:before{
            border: none;
        }
        .weui-grid__icon{
            width: 50px;
            height: 50px;
            margin-bottom: -10px;
        }
        .weui-grid__label{
            height: 30px;
            line-height: 30px;
            margin-top: 0 !important;
        }

    </style>
</head>

<body>
    <!--标题头-->
    <div class="comm-title-red fix-top">
        <a href="javascript:history.back(-1);" class="comm-title-red__back"><img src="../assets/img/common/icon-back.png" alt=""></a>
        <p>刘星</p>
    </div>

    <!--内容-->
    <div class="box">
        <!--聊天窗口-->
        <div class="cont" id="cont">
            <div class="chat">
                <img class="ava" src="../assets/img/liuxing.jpg" alt="" />
                <div class="jian"></div>
                <div class="txt">梅溪湖这边太挤了</div>
            </div>
            <div class="chat">
                <img class="ava" src="../assets/img/liuxing.jpg" alt="" />
                <div class="jian"></div>
                <div class="txt">得买别墅</div>
            </div>
            <div class="chat">
                <img class="ava" src="../assets/img/liuxing.jpg" alt="" />
                <div class="jian"></div>
                <div class="txt">我中了100万彩票，等下分你50万</div>
            </div>
            <div class="chat mychat">
                <img class="ava" src="../assets/img/bo.jpg" alt="" />
                <div class="jian"></div>
                <div class="txt">额。。你老婆知道这个事吗</div>
            </div>
            <div class="chat">
                <img class="ava" src="../assets/img/liuxing.jpg" alt="" />
                <div class="jian"></div>
                <div class="txt">她还不知道，我不想告诉她。。</div>
            </div>
            <div class="chat mychat">
                <img class="ava" src="../assets/img/bo.jpg" alt="" />
                <div class="jian"></div>
                <div class="txt">虽然这样不好吧   但是我已经迫不及待告诉你我的卡号了~~</div>
            </div>
        </div>

            <!--操作栏-->
        <div class="bar">
            <div class="opts">
                <input class="weui-input ipt" id="ipt" />
                <div class="btns">
                    <a class="btn btn-emoji" id="btn-emoji"><img src="../assets/img/chat/icon-emoji.png"></a>
                    <a class="btn btn-more" id="btn-more"><img src="../assets/img/chat/icon-more.png"></a>
                    <a class="btn btn-send" id="btn-send" hidden>发送</a>
                </div>
            </div>
            <div class="menus" id="menus" hidden>
                <div class="weui-grids">
                    <a href="mine-rules.html" class="weui-grid js_grid">
                        <div class="weui-grid__icon">
                            <img src="../assets/img/chat/icon-wanfa.png">
                        </div>
                        <p class="weui-grid__label gray">
                            玩法
                        </p>
                    </a>
                    <a href="mine-faq.html" class="weui-grid js_grid">
                        <div class="weui-grid__icon">
                            <img src="../assets/img/chat/icon-bangzhu.png">
                        </div>
                        <p class="weui-grid__label gray">
                            帮助
                        </p>
                    </a>
                    <a href="mine-proxy-main.html" class="weui-grid js_grid">
                        <div class="weui-grid__icon">
                            <img src="../assets/img/chat/icon-jiameng.png">
                        </div>
                        <p class="weui-grid__label gray">
                            加盟
                        </p>
                    </a>
                    <a class="weui-grid js_grid">
                        <div class="weui-grid__icon">
                            <img src="../assets/img/chat/icon-kefu.png">
                        </div>
                        <p class="weui-grid__label gray">
                            客服
                        </p>
                    </a>
                    <a href="mine-recharge.html" class="weui-grid js_grid">
                        <div class="weui-grid__icon">
                            <img src="../assets/img/chat/icon-chongzhi.png">
                        </div>
                        <p class="weui-grid__label gray">
                            充值
                        </p>
                    </a>
                    <a href="mine-share-main.html" class="weui-grid js_grid">
                        <div class="weui-grid__icon">
                            <img src="../assets/img/chat/icon-zhuanqian.png">
                        </div>
                        <p class="weui-grid__label gray">
                            赚钱
                        </p>
                    </a>
                    <a class="weui-grid js_grid">
                        <div class="weui-grid__icon">
                            <img src="../assets/img/chat/icon-zhaopian.png">
                        </div>
                        <p class="weui-grid__label gray">
                            照片
                        </p>
                    </a>
                    <a class="weui-grid js_grid">
                        <div class="weui-grid__icon">
                            <img src="../assets/img/chat/icon-paizhao.png">
                        </div>
                        <p class="weui-grid__label gray">
                            拍照
                        </p>
                    </a>
                </div>
            </div>

        </div>


    </div>







<script src="../lib/jquery-3.4.1.min.js"></script>
<!--<script src="../../lib/fastclick.js"></script>-->
<script src="../lib/jquery-weui.min.js"></script>
<script>
    $(function() {
        //发送消息
        var $cont = $("#cont");
        var $ipt = $("#ipt");
        var $btnSend = $("#btn-send");
        var $btnMore = $("#btn-more");
        var $menus = $("#menus");
        var _isMenusShow = false;

        //默认滚屏到最下
        scrollToBottom();

        //输入框变化
        $btnSend.hide();
        $ipt.bind("input propertychange",function(event){
            var str = $(this).val();
            if(str.length>0){
                $btnSend.show();
                $btnMore.hide();
            }else{
                $btnSend.hide();
                $btnMore.show();
            }
        });

        //发送文本
        $btnSend.click(function(){
            sendMsg();
            $btnSend.hide();
            $btnMore.show();
        });
        function sendMsg(){
            var str = $ipt.val();
            if(str.trim() != ""){
                console.log("send message:"+str);
                var html = "<div class='chat mychat'>" +
                    "<img class='ava' src='../assets/img/bo.jpg'/>" +
                    "<div class='jian'></div>" +
                    "<div class='txt'>"+str+"</div>" +
                    "</div>";
                $cont.append(html);

                var scrollHeight = $cont.prop("scrollHeight");
                $cont.animate({scrollTop:scrollHeight}, 400);
                // $cont.scrollTop(scrollHeight);

                $ipt.val("");
                $ipt.focus();
                // setTimeout("$ipt.focus()",1);
            }
        }

        //展开功能
        $btnMore.click(function(){
            _isMenusShow = !_isMenusShow;
            if(_isMenusShow){
                $menus.show();
                $cont.css("bottom","220px");
                scrollToBottom();
            }else{
                $menus.hide();
                $cont.css("bottom","60px");
            }
        });

        //输入框获得焦点时，面板隐藏
        $ipt.focus(function(){
            $menus.hide();
            $cont.css("bottom","60px");
            _isMenusShow = false;
        });

        //内容面板滑动时，面板隐藏
        /*$cont.scroll(function(){
            $menus.hide();
            $cont.css("bottom","60px");
            _isMenusShow = false;
        });*/



        function scrollToBottom(){
            var scrollHeight = $cont.prop("scrollHeight");
            $cont.animate({scrollTop:scrollHeight}, 400);
        }

        //code here


    });



</script>

</body>
</html>
